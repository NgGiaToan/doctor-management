{"ast":null,"code":"import _slicedToArray from\"C:/Users/giato/Downloads/Workspace/.Net/api/doctor-management-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import FuseScrollbars from'@fuse/core/FuseScrollbars';import{lighten,styled}from'@mui/material/styles';import IconButton from'@mui/material/IconButton';import Typography from'@mui/material/Typography';import clsx from'clsx';import formatDistanceToNow from'date-fns/formatDistanceToNow';import{useContext,useEffect,useRef,useState}from'react';import{useDispatch,useSelector}from'react-redux';import InputBase from'@mui/material/InputBase';import Paper from'@mui/material/Paper';import FuseSvgIcon from'@fuse/core/FuseSvgIcon';import Toolbar from'@mui/material/Toolbar';import{useParams}from'react-router-dom';import Box from'@mui/material/Box';import{getChat,selectChat,sendMessage}from'../store/chatSlice';import{selectContactById}from'../store/contactsSlice';import{selectUser}from'../store/userSlice';import ContactAvatar from'../ContactAvatar';import ChatMoreMenu from'./ChatMoreMenu';import{ChatAppContext}from'../ChatApp';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StyledMessageRow=styled('div')(function(_ref){var theme=_ref.theme;return{'&.contact':{'& .bubble':{backgroundColor:theme.palette.secondary.light,color:theme.palette.secondary.contrastText,borderTopLeftRadius:5,borderBottomLeftRadius:5,borderTopRightRadius:20,borderBottomRightRadius:20,'& .time':{marginLeft:12}},'&.first-of-group':{'& .bubble':{borderTopLeftRadius:20}},'&.last-of-group':{'& .bubble':{borderBottomLeftRadius:20}}},'&.me':{paddingLeft:40,'& .bubble':{marginLeft:'auto',backgroundColor:theme.palette.primary.light,color:theme.palette.primary.contrastText,borderTopLeftRadius:20,borderBottomLeftRadius:20,borderTopRightRadius:5,borderBottomRightRadius:5,'& .time':{justifyContent:'flex-end',right:0,marginRight:12}},'&.first-of-group':{'& .bubble':{borderTopRightRadius:20}},'&.last-of-group':{'& .bubble':{borderBottomRightRadius:20}}},'&.contact + .me, &.me + .contact':{paddingTop:20,marginTop:20},'&.first-of-group':{'& .bubble':{borderTopLeftRadius:20,paddingTop:13}},'&.last-of-group':{'& .bubble':{borderBottomLeftRadius:20,paddingBottom:13,'& .time':{display:'flex'}}}};});function Chat(props){var _useContext=useContext(ChatAppContext),setMainSidebarOpen=_useContext.setMainSidebarOpen,setContactSidebarOpen=_useContext.setContactSidebarOpen;var dispatch=useDispatch();var chat=useSelector(selectChat);var user=useSelector(selectUser);var routeParams=useParams();var contactId=routeParams.id;var selectedContact=useSelector(function(state){return selectContactById(state,contactId);});var chatRef=useRef(null);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),messageText=_useState2[0],setMessageText=_useState2[1];useEffect(function(){dispatch(getChat(contactId));},[contactId,dispatch]);useEffect(function(){if(chat){setTimeout(scrollToBottom);}},[chat]);function scrollToBottom(){if(!chatRef.current){return;}chatRef.current.scrollTo({top:chatRef.current.scrollHeight,behavior:'smooth'});}function isFirstMessageOfGroup(item,i){return i===0||chat[i-1]&&chat[i-1].contactId!==item.contactId;}function isLastMessageOfGroup(item,i){return i===chat.length-1||chat[i+1]&&chat[i+1].contactId!==item.contactId;}function onInputChange(ev){setMessageText(ev.target.value);}function onMessageSubmit(ev){ev.preventDefault();if(messageText===''){return;}dispatch(sendMessage({messageText:messageText,contactId:contactId})).then(function(){setMessageText('');});}if(!user||!chat||!selectedContact){return null;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Box,{className:\"w-full border-b-1\",sx:{backgroundColor:function backgroundColor(theme){return theme.palette.mode==='light'?lighten(theme.palette.background.default,0.4):lighten(theme.palette.background.default,0.02);}},children:/*#__PURE__*/_jsxs(Toolbar,{className:\"flex items-center justify-between px-16 w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"Open drawer\",onClick:function onClick(){return setMainSidebarOpen(true);},className:\"flex lg:hidden\",size:\"large\",children:/*#__PURE__*/_jsx(FuseSvgIcon,{children:\"heroicons-outline:chat\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center cursor-pointer\",onClick:function onClick(){setContactSidebarOpen(true);},onKeyDown:function onKeyDown(){return setContactSidebarOpen(true);},role:\"button\",tabIndex:0,children:[/*#__PURE__*/_jsx(ContactAvatar,{className:\"relative mx-8\",contact:selectedContact}),/*#__PURE__*/_jsx(Typography,{color:\"inherit\",className:\"text-16 font-semibold px-4\",children:selectedContact.name})]})]}),/*#__PURE__*/_jsx(ChatMoreMenu,{className:\"-mx-8\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-auto h-full min-h-0 w-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:clsx('flex flex-1 z-10 flex-col relative',props.className),children:[/*#__PURE__*/_jsx(FuseScrollbars,{ref:chatRef,className:\"flex flex-1 flex-col overflow-y-auto\",children:(chat===null||chat===void 0?void 0:chat.length)>0&&/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col pt-16 px-16 pb-40\",children:chat.map(function(item,i){return/*#__PURE__*/_jsx(StyledMessageRow,{className:clsx('flex flex-col grow-0 shrink-0 items-start justify-end relative px-16 pb-4',item.contactId===user.id?'me':'contact',{'first-of-group':isFirstMessageOfGroup(item,i)},{'last-of-group':isLastMessageOfGroup(item,i)},i+1===chat.length&&'pb-96'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"bubble flex relative items-center justify-center p-12 max-w-full\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"leading-tight whitespace-pre-wrap\",children:item.value}),/*#__PURE__*/_jsx(Typography,{className:\"time absolute hidden w-full text-11 mt-8 -mb-24 ltr:left-0 rtl:right-0 bottom-0 whitespace-nowrap\",color:\"text.secondary\",children:formatDistanceToNow(new Date(item.createdAt),{addSuffix:true})})]})},i);})})}),chat&&/*#__PURE__*/_jsx(Paper,{square:true,component:\"form\",onSubmit:onMessageSubmit,className:\"absolute border-t-1 bottom-0 right-0 left-0 py-16 px-16\",sx:{backgroundColor:function backgroundColor(theme){return theme.palette.mode==='light'?lighten(theme.palette.background.default,0.4):lighten(theme.palette.background.default,0.02);}},children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center relative\",children:[/*#__PURE__*/_jsx(IconButton,{className:\"\",type:\"submit\",size:\"large\",children:/*#__PURE__*/_jsx(FuseSvgIcon,{className:\"text-24\",color:\"action\",children:\"heroicons-outline:emoji-happy\"})}),/*#__PURE__*/_jsx(IconButton,{className:\"\",type:\"submit\",size:\"large\",children:/*#__PURE__*/_jsx(FuseSvgIcon,{className:\"text-24\",color:\"action\",children:\"heroicons-outline:paper-clip\"})}),/*#__PURE__*/_jsx(InputBase,{autoFocus:false,id:\"message-input\",className:\"flex-1 flex grow shrink-0 h-44 mx-8 px-16 border-2 rounded-full\",placeholder:\"Type your message\",onChange:onInputChange,value:messageText,sx:{backgroundColor:'background.paper'}}),/*#__PURE__*/_jsx(IconButton,{className:\"\",type:\"submit\",size:\"large\",children:/*#__PURE__*/_jsx(FuseSvgIcon,{className:\"rotate-90\",color:\"action\",children:\"heroicons-outline:paper-airplane\"})})]})})]})})]});}export default Chat;","map":null,"metadata":{},"sourceType":"module"}